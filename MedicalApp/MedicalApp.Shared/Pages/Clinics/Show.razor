@page "/clinics/{Id:int}"
@using MedicalApp.Shared.Models
@inject MedicalApp.Shared.Data.AppDbContext DbContext
@inject NavigationManager NavManager
@inject HubConnection HubCon
@inject ToastService ToastService

<PageTitle>@Model?.ClinicName | Clinic</PageTitle>

<div class="container">
    <div class="d-flex gap-2 align-items-center mb-4">
        <div class="me-auto">
            <h3 class="page-title mb-0">@Model?.ClinicName</h3>
        </div>
        <div>
            <div class="d-flex gap-2">
                <Button Type="ButtonType.Link" Color="ButtonColor.Primary" To="@($"/clinics/upsert/{Id}")"><Icon Name="IconName.Pen"></Icon> Edit</Button>
                <Button Color="ButtonColor.Danger" title="Delete" @onclick="@(() => DeleteConfirm_ref.ShowModal())"><Icon Name="IconName.Trash"></Icon></Button>
            </div>
        </div>
    </div>

</div>

@* Modal Delete *@
<DeleteConfirm @ref="DeleteConfirm_ref" Model="Model" />

@code {
    private DeleteConfirm DeleteConfirm_ref = default!;

    [Parameter]
    public int? Id { get; set; }

    private Clinic? Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // Get Model
        Model = await DbContext.Clinic.FindAsync(Id);
        if (Model == null) NavManager.NavigateTo("notfound");

        // Hub connection
        HubCon.On<int, string>("ClinicModified", async (int id, string action) =>
        {
            if (action == "deleted" && id == Id)
            {
                ToastService.Notify(new ToastMessage(ToastType.Danger, $"Clinic was deleted."));
                return;
            }
            Model = await DbContext.Clinic.FindAsync(Id);
        });
    }
}
